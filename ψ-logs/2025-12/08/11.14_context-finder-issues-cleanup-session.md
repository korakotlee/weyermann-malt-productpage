# Context-finder & Issues-cleanup Session

**Time**: 11:14 GMT+7
**Branch**: main

## What We Learned

- **Reference checking prevents bad cleanup decisions** - counting refs in ψ-retrospectives/, ψ-learnings/, ψ-logs/, and git log before closing
- **0 refs = safe to close** - if nothing references an issue, it's truly orphaned
- **Embedded context-finder logic** - subagents can't spawn subagents, so embed the search logic directly
- **GitHub links make outputs traceable** - `[#N](repo/issues/N)` format works everywhere

## How Things Connect

- **context-finder → issues-cleanup**: Cleanup agent uses context-finder's search patterns (grep, git log) to check references
- **events.md → learnings**: Events log captures actions, learnings distill patterns
- **/snapshot → events.md**: Snapshot adds to daily event log for tracking
- **Decision matrix → safer cleanup**: 0=close, 1-2=review, 3+=keep prevents mistakes

## Key Discoveries

- jq `startswith()` fails with emoji → use `test()` regex
- Haiku agents can't spawn other agents → embed logic instead
- GitHub auto-links `#N` but full URLs work in local markdown too
- Checking 40+ issues for refs is slow (~3 min) but worth it

## Commits
- `480734b` 11:13 - feat: Add GitHub links to issues-cleanup output
- `36fa744` 11:11 - learn: Reference-based cleanup
- `c126250` 11:08 - log: Issues cleanup - closed 15 orphaned issues
- `4215142` 10:55 - feat: issues-cleanup checks references
- `909498b` 10:51 - fix: only list OPEN issues to close
- `071fe8f` 10:46 - feat: issues-cleanup logs to events.md
- `c7fb435` 10:41 - refactor: /snapshot knowledge focus

## Tags
`context-finder` `issues-cleanup` `reference-checking` `events-log` `github-links` `subagent`

## Raw Thoughts

- The test-refine-score loop works well for subagent development
- Events log could become the "source of truth" for what happened
- Could batch grep for speed: `grep -roh "#[0-9]+" | sort | uniq -c`
- Pattern "consult before acting" applies broadly: delete file → check imports, close issue → check refs
